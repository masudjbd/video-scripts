<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="../stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="../stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="../stylesheets/linenumbers.css" media="screen">

    <title>Video Scripts by tylerneylon</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1><a href="../index.html">Learn Lua in an Hour</a></h1>
        <h2>require and modules</h2>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
<!-- 12.1 require/module intro -->

<p>The <code>io</code> table is an example of a module.
The word <em>module</em> in Lua basically means a library.
The built-in <code>require</code> function is the standard way
of including modules.
It's sort of like an <code>import</code> statement in Python or a
<code>#include</code> in C-like languages.</p>
<!-- 12.2 the vec.lua module -->

<p>In order to demonstrate modules, I'll build a simple
one called <code>vec.lua</code> (code below, typed in sync with this text).
This will be a module that works with two-dimensional vectors.</p>
<p>I'll start by defining a function that computes the norm of
a vector.
The <em>norm</em> of a vector is basically its distance from zero.</p>
<p>I'll also define a distance function which computes the
distance between
any two given two-dimensional vectors</p>
<p>I can reuse the <code>norm</code> function
to help me with that calculation, like this.</p>
<p>Remember that chunks are compiled as the body of a function,
so a good way to get the <code>vec</code> table out
is to return the value.</p>
<pre><code>-- In the file vec.lua:

local vec = {}

vec.norm = function (x, y)
  return math.sqrt(x * x + y * y)
end

vec.dist = function(x1, y1, x2, y2)
  return vec.norm(x1 - x2, y1 - y2)
end

return vec
</code></pre>
<!-- 12.3 loadfile and dofile -->

<p>Next I'm going to describe three functions building up
in complexity to the <code>require</code> function.</p>
<p>Simplest is the <code>loadfile</code> function, which loads a Lua file,
compiles it as a chunk, and then returns a function which will
execute that chunk.</p>
<pre><code>&gt; f = loadfile('vec.lua')
</code></pre>
<p><code>loadfile</code> itself does not actually run the code.
If I call the function, then the code is finally run.</p>
<pre><code>&gt; vec = f()
</code></pre>
<p>Now I should have a table in the <code>vec</code> variable, and I
can call functions on it -- for example, here's the norm
of <code>(1, 1)</code>:</p>
<pre><code>&gt; = vec
table: 0x7f91e1d14070
&gt; = vec.norm(1, 1)
1.4142135623731
</code></pre>
<p>The next function in complexity is the function <code>dofile</code>,
which works similarly to <code>loadfile</code>, except that it also
takes the extra step of actually executing the code
and returning the value from the chunk.</p>
<pre><code>&gt; v = dofile('vec.lua')
</code></pre>
<p>So <code>v</code> will
have the same functions as <code>vec</code> above.</p>
<pre><code>&gt; = v
table: 0x7f91e1d145c0
&gt; = v.norm(1, 2)
2.2360679774998
</code></pre>
<!-- 12.4 require -->

<p>The last function that I'll describe is the <code>require</code> function.</p>
<p>The first difference you'll notice is that I don't have to add
the <code>.lua</code> filename extension at the end.</p>
<pre><code>&gt; v2 = require('vec')
</code></pre>
<p>Now this is actually a different table than the previous two values,
although it has the same functionality.</p>
<pre><code>&gt; = v2
table: 0x7f91e1f15780
&gt; = v2.norm(1, 3)
3.1622776601684
</code></pre>
<p>One difference between <code>require</code> and <code>dofile</code>
is that <code>require</code> caches its values.
So if I call it again with the same input, it will actually give me
the same return value as before, as opposed to re-executing the module.</p>
<pre><code>&gt; v3 = require('vec')
&gt; = v2 == v3
true
</code></pre>
<p>The final difference is that <code>require</code> searches through a path
specified in the <code>package.path</code> string.</p>
<pre><code>&gt; = package.path
./?.lua;/usr/local/share/lua/5.1/?.lua;/usr/local/share/lua/5.1/?/init.lua;/usr/local/lib/lua/5.1/?.lua;/usr/local/lib/lua/5.1/?/init.lua
</code></pre>
<p>So it will look in multiple locations for your Lua files.</p>
<p>It's a common practice to assign the return value of a <code>require</code> call
to a variable of the same name as the module, like this:</p>
<pre><code>&gt; io = require('io')
</code></pre><a href="part13.html" style="float:right">Next</a>
      </section>
    </div>

    
    
  </body>
</html>
